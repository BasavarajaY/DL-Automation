sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/ui/export/Spreadsheet"],function(e,t,o,i,n){"use strict";var a;var s=sap.ui.Device;return e.extend("com.extentia.dlrulecreate.controller.DLList",{onInit:function(){gDListView=this.getView();this.onInitHookUp()},onInitHookUp:function(){this._oView=this.getView();this._oComponent=sap.ui.component(sap.ui.core.Component.getOwnerIdFor(this._oView));a=this._oComponent.getModel("i18n").getResourceBundle();this._oRouter=sap.ui.core.UIComponent.getRouterFor(this);this._oRouter.attachRouteMatched(this.onRouteMatched,this);if(this.onInitHookUp_Exit){this.onInitHookUp_Exit()}},onRouteMatched:function(e){if(e.getParameter("name")!=="DLListPage"){return}this.setDefaultSettings()},setDefaultSettings:function(){var e=new sap.ui.model.json.JSONModel;this.viewSettingData={ListItemsCount:0};e.setData(this.viewSettingData);this._oComponent.setModel(e,"LocalViewSetting");if(this.setDefaultSettings_Exit){this.setDefaultSettings_Exit()}},onSearch:function(){this.setListItems()},setListItems:function(){var e=[{Region:"APJ",SubRegion:"ANZ",CompanyCode:"0014",Solutions:"Solutions1",PrimaryHub:"PSH-Architecting- APJ",SecondaryHub:"PSH-Public Sector Solutions- APJ"},{Region:"GCO",SubRegion:"APJ-Regional",CompanyCode:"0015",Solutions:"Solutions2",PrimaryHub:"PSH-Manager- APJ",SecondaryHub:"PSH-DSC Supply"},{Region:"GC",SubRegion:"GC CN",CompanyCode:"0016",Solutions:"Solutions3",PrimaryHub:"PSH-Finance- APJ",SecondaryHub:"PSH-Public Sector Finance- APJ"},{Region:"ISV",SubRegion:"ISV-APJ",CompanyCode:"0017",Solutions:"Solutions4",PrimaryHub:"PSH-Architecting- APJ",SecondaryHub:"PSH-Public Sector Solutions- APJ"},{Region:"APJ",SubRegion:"ANZ",CompanyCode:"0014",Solutions:"Solutions5",PrimaryHub:"PSH-Architecting- APJ",SecondaryHub:"PSH-Public Sector Solutions- APJ"}];var t=new sap.ui.model.json.JSONModel;t.setData(e);this.getView().setModel(t,"ListItems");this.getView().getModel("LocalViewSetting").setProperty("/ListItemsCount",e.length)},setDialog:function(){},handleRuleCreate:function(e){this.setDialogCheckBox(e)},setDialogCheckBox:function(e){if(!this._fraDialog){this._fraDialog=sap.ui.xmlfragment("fragmId","com.extentia.dlrulecreate.fragments.RuleDialog",this)}var t=!!e.getSource().data("multi");this._fraDialog.setMultiSelect(t);var o=!!e.getSource().data("remember");this._fraDialog.setRememberSelections(o);jQuery.sap.syncStyleClass(this.getView().getController().getOwnerComponent().getContentDensityClass(),this.getView(),this._fraDialog);this.setCheckBoxItems();this.getView().addDependent(this._fraDialog);this._fraDialog.open()},handleSearch:function(e){var t=e.getParameter("value");var o=new sap.ui.model.Filter("value",sap.ui.model.FilterOperator.Contains,t);var i=e.getSource().getBinding("items");i.filter([o])},handleSelect:function(e){var t=e.getParameter("selectedContexts");if(t.length){var o=[];t.map(function(e){o.push({RuleKey:e.getObject().key,RuleDesc:e.getObject().value})});this._oRouter.navTo("DLRuleCreate",{contextPath:encodeURIComponent(JSON.stringify(o))},false)}e.getSource().getBinding("items").filter([])},setCheckBoxItems:function(){var e=[{key:"01",value:"Region",selected:false},{key:"02",value:"SubRegion",selected:false},{key:"03",value:"Primary Hub",selected:false},{key:"04",value:"Primary Hub DL",selected:false},{key:"05",value:"Secondary Hub",selected:false},{key:"06",value:"Secondary Hub DL",selected:false},{key:"07",value:"Company Code",selected:false},{key:"08",value:"Solutions",selected:false}];var t=new sap.ui.model.json.JSONModel;t.setData(e);this._fraDialog.setModel(t,"checkBoxItems")},onCancel:function(){this._fraDialog.close()},onSubmit:function(e){var o=this._fraDialog.getModel("checkBoxItems").getProperty("/");var i=0;var n=[];for(var a=0;a<o.length;a++){if(o[a].selected){n.push({RuleKey:o[a].key,RuleDesc:o[a].value});i++}}if(i===0){t.error("selct atleast one checkbox to create Rule")}else{this._oRouter.navTo("DLRuleCreate",{contextPath:encodeURIComponent(JSON.stringify(n))},false);this._fraDialog.close()}},RegionF4:function(e){var t=this;var o="Region";this.TokenInput=e.getSource();this.TokenKeys=["RegionCode","RegionName"];this.setValueHelp({title:o,oController:this,controlID:"inputRegionF4",idLabel:o+" Code",descriptionLabel:o,tokenInput:this.TokenInput,aKeys:this.TokenKeys,bMultiSelect:false,defaultVisible:false,idVisible:true,groupTitle:o,fireOnLoad:false},function(e){var o=e.getParameter("tokens");var i=o[0].getCustomData()[0].getValue();t.TokenInput.removeAllTokens();t.TokenInput.addToken(new sap.m.Token({key:i.key,text:i.desc+" ("+i.key+")"}));t.TokenInput.setTooltip(i.desc)});if(this.RegionF4_Exit){this.RegionF4_Exit(e)}},SubRegionF4:function(e){var t=this;var o="SubRegion";this.TokenInput=e.getSource();this.TokenKeys=["SubRegionCode","SubRegionName"];this.setValueHelp({title:o,oController:this,controlID:"inputSubRegionF4",idLabel:o+" Code",descriptionLabel:o,tokenInput:this.TokenInput,aKeys:this.TokenKeys,bMultiSelect:false,defaultVisible:false,idVisible:true,groupTitle:o,fireOnLoad:false},function(e){var o=e.getParameter("tokens");var i=o[0].getCustomData()[0].getValue();t.TokenInput.removeAllTokens();t.TokenInput.addToken(new sap.m.Token({key:i.key,text:i.desc+" ("+i.key+")"}));t.TokenInput.setTooltip(i.desc)});if(this.RegionF4_Exit){this.RegionF4_Exit(e)}},CompanyCodeF4:function(e){var t=this;var o="Company";this.TokenInput=e.getSource();this.TokenKeys=["CompanyCode","CompanyName"];this.setValueHelp({title:o,oController:this,controlID:"inputCompanyCodeF4",idLabel:o+" Code",descriptionLabel:o,tokenInput:this.TokenInput,aKeys:this.TokenKeys,bMultiSelect:false,defaultVisible:false,idVisible:true,groupTitle:o,fireOnLoad:false},function(e){var o=e.getParameter("tokens");var i=o[0].getCustomData()[0].getValue();t.TokenInput.removeAllTokens();t.TokenInput.addToken(new sap.m.Token({key:i.key,text:i.desc+" ("+i.key+")"}));t.TokenInput.setTooltip(i.desc)});if(this.RegionF4_Exit){this.RegionF4_Exit(e)}},setValueHelp:function(e,t){var o=new sap.ui.comp.valuehelpdialog.ValueHelpDialog({title:e.title,supportMultiselect:e.bMultiSelect,supportRanges:false,supportRangesOnly:false,key:e.aKeys[0],descriptionKey:e.aKeys[1],stretch:sap.ui.Device.system.phone,ok:function(i){e.tokenInput.setTokens(i.getParameter("tokens"));if(t){t(i)}o.close()},cancel:function(){o.close()},afterClose:function(){o.destroy()}});this.setValueHelpColumns(o,e);this.setValueHelpFilterBar(o,e);if(sap.ui.Device.support.touch===false){o.addStyleClass("sapUiSizeCompact")}o.open();if(e.oController.tokenInput){o.setTokens(e.oController.tokenInput.getTokens())}if(e.fireOnLoad&&sap.ui.getCore().byId(e.controlID)){sap.ui.getCore().byId(e.controlID).fireSearch()}},setValueHelpColumns:function(e,t){if(e.getTable().bindItems){var o=new sap.ui.model.json.JSONModel;o.setData({cols:[{label:t.idLabel,template:"key"},{label:t.descriptionLabel,template:"desc"}]});e.getTable().setModel(o,"columns")}else{e.getTable().addColumn(new sap.ui.table.Column({label:t.idLabel,template:new sap.m.Text({text:"{key}"}),sortProperty:"key",filterProperty:"key"}));e.getTable().addColumn(new sap.ui.table.Column({label:t.descriptionLabel,template:new sap.m.Text({text:"{desc}"}),sortProperty:"desc",filterProperty:"desc"}));e.getTable().setNoData("No Item Selected")}},setValueHelpFilterBar:function(e,t){var o=this;var i=new sap.m.BusyDialog;var n="";if(t.oController.tokenInput){n=t.oController.tokenInput.getValue()}var a=new sap.m.Input({});var s=new sap.m.Input({});e.setFilterBar(new sap.ui.comp.filterbar.FilterBar({advancedMode:true,filterGroupItems:[new sap.ui.comp.filterbar.FilterGroupItem({groupName:"gn1",name:"n1",label:t.idLabel,control:a,visible:t.idVisible}),new sap.ui.comp.filterbar.FilterGroupItem({groupName:"gn2",name:"n2",label:t.descriptionLabel,control:s,visible:t.descriptionVisible})],search:function(){var i=o.setValueHelpModels(t.title);var n=new sap.ui.model.json.JSONModel;if(e.getTable().bindRows){e.getTable().clearSelection();n.setData(i);e.getTable().setModel(n);e.getTable().bindRows("/");if(i.length==0){e.getTable().setNoData("No Results Found")}}else{var a=new sap.ui.model.json.JSONModel;a.setData(i);e.getTable().setModel(a);if(e.getTable().bindItems){var s=e.getTable();s.bindAggregation("items","/",function(){var e=s.getModel("columns").getData().cols;return new sap.m.ColumnListItem({cells:e.map(function(e){var t=e.template;return new sap.m.Text({text:"{"+t+"}",wrapping:true})})})})}if(i.length===0){e.getTable().setNoDataText("No Results Found")}}}}))},setValueHelpModels:function(e){var t="";if(e==="Region"){t=[{key:"01",desc:"APJ"},{key:"02",desc:"GCO"},{key:"03",desc:"ISV"},{key:"04",desc:"CX"}]}else if(e==="SubRegion"){t=[{key:"01",desc:"ANZ"},{key:"02",desc:"APJ-Regional"},{key:"03",desc:"India"},{key:"04",desc:"GC-CN"}]}else if(e==="Company"){t=[{key:"01",desc:"0014"},{key:"02",desc:"0018"},{key:"03",desc:"00123"},{key:"04",desc:"0182"}]}return t},handleViewSettingsDialogButtonPressed:function(e){if(!this.FilterDialog){this.FilterDialog=sap.ui.xmlfragment("com.extentia.dlrulecreate.fragments.FilterDialog",this)}var t=this.getView().getModel("ListItems");this.FilterDialog.setModel(t,"ListItems");jQuery.sap.syncStyleClass("sapUiSizeCompact",this.getView(),this.FilterDialog);this.FilterDialog.open()},exportToExcel:sap.m.Table.prototype.exportData||function(e){var t=new n({dataSource:this.getView().getModel("ListItems").getProperty("/"),fileName:"DlListItems.xlsx",workbook:{columns:[{label:"Region",property:"Region",width:20},{label:"SubRegion",property:"SubRegion"},{label:"Company Code",property:"CompanyCode",width:20},{label:"Solutions",property:"Solutions",width:20},{label:"Primary Hub",property:"PrimaryHub",width:20},{label:"Secondary Hub",property:"SecondaryHub",width:20}]}});t.build().then(function(){jQuery.sap.log.debug("Export is finished")}).catch(function(e){jQuery.sap.log.error("Export error: "+e)})},gotoDetails:function(e){var t=e.getSource().getBindingContext("ListItems")}})});